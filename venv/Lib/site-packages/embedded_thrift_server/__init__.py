import os
import sys
from pathlib import Path
from urllib.request import urlretrieve

import thrift
from importlib_metadata import version


__version__='1.16.3'


if sys.platform == 'win32':
    # Download Thrift exe file from Apache archive if exe is not found locally
    thrift_version = version(thrift.__name__)
    exe_name = f'thrift-{thrift_version}.exe'
    exe_file = Path(__file__).parent / exe_name
    if not exe_file.exists():  # Download from thrift archive
        url = f"http://archive.apache.org/dist/thrift/{thrift_version}/{exe_name}"
        urlretrieve(url, exe_file)
        # Delete every other thrift exe file
        for exe_file in exe_file.parent.glob('thrift*.exe'):
            print(exe_file)
            if thrift_version not in exe_file.name:  # Delete
                os.remove(exe_file)
