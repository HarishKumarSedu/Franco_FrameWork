#!/usr/bin/ruby
# encoding: utf-8
################################################################################
###
### Copyright (c) 2014 Wolfson Microelectronics plc.  All rights reserved.
###
### This software as well as any related documentation is furnished under 
### license and may only be used or copied in accordance with the terms of the 
### license. The information in this file is furnished for informational use 
### only, is subject to change without notice, and should not be construed as 
### a commitment by Wolfson Microelectronics plc. Wolfson Microelectronics plc
### assumes no responsibility or liability for any errors or inaccuracies that
### may appear in this document or any software that may be provided in
### association with this document. 
###
### Except as permitted by such license, no part of this document may be 
### reproduced, stored in a retrieval system, or transmitted in any form or by 
### any means without the express written consent of Wolfson Microelectronics plc. 
###
### @file   run_tests.rb
### @brief  Launcher script for Fruit Salad that sets up the environment.
###
### @version \$Id: increment_next_version.rb 482 2014-11-20 16:07:28Z shackman $
###
### Warning
###   This software is specifically written for Wolfson devices. It may not be
###   used with other devices.
###
#################################################################################

###############################################################################
#
# Given the current version number, automatically calculate the next version
# number by incrementing the patch number then automatically write it to
# next_version.txt
#
# @param [String] string The version number string for the last version.
#
# @return [String] The version number string for the next version.
# 
###############################################################################
def increment_patch_number( string )
    unless /(\d+)\.(\d+)\.(\d+)/ =~ string
        raise "Could not match version.txt: #{string}"
    end
    puts $~
    next_version = "#{$~[1]}.#{$~[2]}.#{$~[3].to_i+1}"
    
    file = File.new( "next_version.txt", "wb" )
    file.print( next_version )
    file.close

    puts "Next version will be: #{next_version}"
    return next_version
end

if __FILE__ == $0
    file = File.new( "version.txt", "r" )
    version = file.gets
    file.close

    increment_patch_number( version )

end

############################## END OF FILE ####################################
