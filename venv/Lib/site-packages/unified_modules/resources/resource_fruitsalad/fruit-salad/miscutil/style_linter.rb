################################################################################
###
### Copyright (c) 2014 Wolfson Microelectronics plc.  All rights reserved.
###
### This software as well as any related documentation is furnished under 
### license and may only be used or copied in accordance with the terms of the 
### license. The information in this file is furnished for informational use 
### only, is subject to change without notice, and should not be construed as 
### a commitment by Wolfson Microelectronics plc. Wolfson Microelectronics plc
### assumes no responsibility or liability for any errors or inaccuracies that
### may appear in this document or any software that may be provided in
### association with this document. 
###
### Except as permitted by such license, no part of this document may be 
### reproduced, stored in a retrieval system, or transmitted in any form or by 
### any means without the express written consent of Wolfson Microelectronics plc. 
###
### @file   style_linter.rb
### @brief  Verifies Ruby files for common mistakes with regard to Wolfson house style
###
### @version \$Id: style_linter.rb 365 2014-11-05 15:03:24Z aangus $
###
### Warning
###   This software is specifically written for Wolfson devices. It may not be
###   used with other devices.
###
#################################################################################

#################################################################################
#
# Searches a ruby file for the most common stylistic errors.
#
# @param [String] filename The relative or absolute path to the file you wish 
#                          to scan
#
#################################################################################
def lint( filename )
    file = File.read( filename )

    # Spaces inside brackets (never outside!)
    file.scan( /^[^#\/$]*[A-Za-z0-9] \(.*$/ ) do |match|
        unless /[\.][\.]/ =~ match or /".*\(.*\).*"/ =~ match
            puts "Preceeding space in #{filename}: #{match.strip}"
        end
    end

    file.scan( /^[^#\/$]*[A-Za-z0-9] ?\([^\s\)].*$/ ) do |match|
        unless /[\.][\.]/ =~ match or /".*\(.*\).*"/ =~ match
            puts "Missing space inside brackets in #{filename}: #{match.strip}"
        end
    end
end

#################################################################################
#
# Scan all Ruby files in all subdirectories of the current working directory.
#
#################################################################################
if __FILE__ == $0

    files = Dir["./**/*.rb"]
    files.each do |file|
        lint( file )
    end

end
