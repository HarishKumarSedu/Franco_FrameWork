#!/usr/bin/ruby
################################################################################
### Copyright (c) 2017 Cirrus Logic International (UK) Ltd.  All rights reserved.
###
### This software as well as any related documentation is furnished under
### license and may only be used or copied in accordance with the terms of the
### license. The information in this file is furnished for informational use
### only, is subject to change without notice, and should not be construed as
### a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
### (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
### that may appear in this document or any software that may be provided in
### association with this document.
###
### Except as permitted by such license, no part of this document may be
### reproduced, stored in a retrieval system, or transmitted in any form or by
### any means without the express written consent of Cirrus Logic International
### (UK) Ltd or affiliated companies.
###
### @file   testAQMWrapper.rb
### @brief  TestCase for testing AQM.dll
###
###
### @warning
###   This software is specifically written for Cirrus Logic devices.
###   It may not be used with other devices.
################################################################################
# ensure that the gem version of test-unit is loaded
# otherwise the report generation will not occur.
gem 'test-unit'
require 'test/unit'

require_relative '../src/fruitsalad_env_setup'
require 'src/aqm_analyzer'

exit unless ENV['TARGET'].nil?

class TestAQMWrapper < Test::Unit::TestCase

    ###########################################################################
    #
    #    @function    testAQMTest
    #
    #    Comparision of Similarity and Dissimilarity of wave files using AQM.dll.
    #
    ###########################################################################
    def testAQMTest
        file1 = 'resources/bluegeenie7.wav'
        file2 = 'resources/440Hz_sinetone.wav'
        output = AQMTest::aqm_test( file1, file2 )
        assert( output > 1, "Error Wave Files must be Dissimilar" )
        $LOG.info "Wave Files are Dissimilar"

        file1 = 'resources/bluegeenie7.wav'
        file2 = 'resources/bluegeenie7.wav'
        output = AQMTest::aqm_test( file1, file2 )
        assert( output < 2, "Error Wave Files must be Similar" )
        $LOG.info "Wave Files are Similar"
    end

end