/*******************************************************************************
 *
 * Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
 *
 * This software as well as any related documentation is furnished under 
 * license and may only be used or copied in accordance with the terms of the 
 * license. The information in this file is furnished for informational use 
 * only, is subject to change without notice, and should not be construed as 
 * a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
 * (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
 * that may appear in this document or any software that may be provided in
 * association with this document. 
 *
 * Except as permitted by such license, no part of this document may be 
 * reproduced, stored in a retrieval system, or transmitted in any form or by 
 * any means without the express written consent of Cirrus Logic International
 * (UK) Ltd or affiliated companies. 
 *
 * @file   init.cpp
 * @brief  Functions which initialize and clean up state for this module.
 *
 * @version \$Id: init.cpp 651 2015-01-05 15:57:22Z aangus $
 *
 * @warning
 *     This software is specifically written for Cirrus Logic devices.
 *     It may not be used with other devices.
 *
 ******************************************************************************/

//
// Includes
//
#include "stdafx.h"
#include "WinDriverTestAPI.h"

//
// Initialisation of global variables
//
namespace WinDriverTestAPI
{
	IMMDeviceEnumerator *pIMMDeviceEnumerator = NULL;
}

///////////////////////////////////////////////////////////////////////////////
//
// Function: Initialize
//
// Allocate and initialize resources for this module.
//
///////////////////////////////////////////////////////////////////////////////
DLL void Initialize()
{
    // Initialize COM
    CoInitialize( NULL );

	// Create a device enumerator if one has not already been created.
	if ( NULL == WinDriverTestAPI::pIMMDeviceEnumerator )
	{		
		HRESULT result = CoCreateInstance( clsidMMDeviceEnumerator, 
										   NULL,
										   CLSCTX_ALL,
										   iidIMMDeviceEnumerator,
										   (void**)&WinDriverTestAPI::pIMMDeviceEnumerator
										 );
		
		if ( S_OK != result ) 
		{
			PrintError( L"WinDriverTestAPI::Initialize", result );
		}	
	}	
}

///////////////////////////////////////////////////////////////////////////////
//
// Function: CleanUp
//
// Deallocate and clean up resources for this module.
//
///////////////////////////////////////////////////////////////////////////////
DLL void CleanUp()
{
    // Deinit COM
    CoUninitialize();
}

//////////////////////////////////// END OF FILE //////////////////////////////