################################################################################
##
## Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
##
## This software as well as any related documentation is furnished under 
## license and may only be used or copied in accordance with the terms of the 
## license. The information in this file is furnished for informational use 
## only, is subject to change without notice, and should not be construed as 
## a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
## (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
## that may appear in this document or any software that may be provided in
## association with this document. 
##
## Except as permitted by such license, no part of this document may be 
## reproduced, stored in a retrieval system, or transmitted in any form or by 
## any means without the express written consent of Cirrus Logic International
## (UK) Ltd or affiliated companies. 
##
### @file   Makefile
### @brief  Saladmix makefile.
###
### @version \$Id: Makefile 748 2015-01-21 16:07:08Z piotrs $
###
### @warning
###   This software is specifically written for Cirrus Logic devices.
###   It may not be used with other devices.###
###
#################################################################################

RM = rm -rf
CP = cp
PATH_SEPARATOR = /
FRUITSALAD_ROOT = ..$(PATH_SEPARATOR)..$(PATH_SEPARATOR)..$(PATH_SEPARATOR)
FRUITSALAD_VENDOR = $(FRUITSALAD_ROOT)vendor$(PATH_SEPARATOR)
INSTALL_DIR = $(FRUITSALAD_ROOT)bin

CC = gcc
CROSS_COMPILE =
CFLAGS = -I $(FRUITSALAD_VENDOR)tinyalsa/include -I ./include -Wall -std=c99
TINYALSA_CFLAGS = -fPIC -Wall -I $(FRUITSALAD_VENDOR)tinyalsa/include

BINARY = $(CROSS_COMPILE)saladmix

SOURCES = saladmix.c

$(BINARY): $(SOURCES)
	$(CROSS_COMPILE)$(CC) -c -o $(CROSS_COMPILE)mixer.o $(FRUITSALAD_VENDOR)tinyalsa/mixer.c $(TINYALSA_CFLAGS) -Os
	$(CROSS_COMPILE)$(CC) -c -o $(CROSS_COMPILE)saladmix.o $(SOURCES) $(CFLAGS) -Os
	$(CROSS_COMPILE)$(CC) -o $@ $(CROSS_COMPILE)mixer.o $(CROSS_COMPILE)saladmix.o $(CFLAGS) -Os

parser_test: $(SOURCES) parser_test.c
	$(CC) -o $@ $(SOURCES) parser_test.c $(CFLAGS) -O0 -g -L $(FRUITSALAD_VENDOR) -ltinyalsa -D _TESTS

.PHONY: clean debug all

all: $(BINARY)

install:
	$(CP) $(BINARY) $(INSTALL_DIR)

clean:
	$(RM) $(BINARY)-debug
	$(RM) $(BINARY)
	$(RM) *.o

debug: $(SOURCES)
	$(CROSS_COMPILE)$(CC) -g -c -o $(CROSS_COMPILE)mixer-debug.o $(FRUITSALAD_VENDOR)tinyalsa/mixer.c $(TINYALSA_CFLAGS) -Os
	$(CROSS_COMPILE)$(CC) -g -c -o $(CROSS_COMPILE)saladmix-debug.o $(SOURCES) $(CFLAGS) -Os
	$(CROSS_COMPILE)$(CC) -g -o $(BINARY)-debug $(CROSS_COMPILE)mixer-debug.o $(CROSS_COMPILE)saladmix-debug.o $(CFLAGS)
