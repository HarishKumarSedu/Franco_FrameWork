################################################################################
###
### Copyright (c) 2014 Wolfson Microelectronics plc.  All rights reserved.
###
### This software as well as any related documentation is furnished under
### license and may only be used or copied in accordance with the terms of the
### license. The information in this file is furnished for informational use
### only, is subject to change without notice, and should not be construed as
### a commitment by Wolfson Microelectronics plc. Wolfson Microelectronics plc
### assumes no responsibility or liability for any errors or inaccuracies that
### may appear in this document or any software that may be provided in
### association with this document.
###
### Except as permitted by such license, no part of this document may be
### reproduced, stored in a retrieval system, or transmitted in any form or by
### any means without the express written consent of Wolfson Microelectronics plc.
###
### @file   tinyalsa_inspect.rb
### @brief  Mixin containing methods for debugging interactions with tinyalsa.
###
### @version \$Id: tinyalsa_inspect.rb 365 2014-11-05 15:03:24Z aangus $
###
### Warning
###   This software is specifically written for Wolfson devices. It may not be
###   used with other devices.
###
#################################################################################

###############################################################################
#
# Module containing mixin methods specifying how to parse the output of
# tinymix invocations, i.e. to inspect the status of one or more mixer controls.
#
###############################################################################

require 'logfw'

module TinyAlsaInspect

    ###########################################################################
    #
    # Parse the output of tinymix for the value of a proprty. Intended for
    # debug and testing purposes.
    #
    # @note At present this method only supports parsing enum-type and Int data.
    #
    # @param [String] string The standard output from tinymix "Some Control".
    #
    # @return [String] The value of that control.
    #
    ###########################################################################
    def self.parse_property( string )

        # Enum and Int data type
        if /(:[^>](.\d*)\s["("])/m =~ string
            string = $~[2]
            $LOG.debug "Int is: #{string}"
            string = string.strip
        elsif />(\S+( \S+)*)/m =~ string
            string = $~[1]
            $LOG.debug "Enum is: #{string}"
            string = string.strip
        end
        return string
    end
end

############################ END OF FILE ######################################