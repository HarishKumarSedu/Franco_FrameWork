###############################################################################
###
### Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
###
### This software as well as any related documentation is furnished under
### license and may only be used or copied in accordance with the terms of the
### license. The information in this file is furnished for informational use
### only, is subject to change without notice, and should not be construed as
### a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
### (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
### that may appear in this document or any software that may be provided in
### association with this document.
###
### Except as permitted by such license, no part of this document may be
### reproduced, stored in a retrieval system, or transmitted in any form or by
### any means without the express written consent of Cirrus Logic International
### (UK) Ltd or affiliated companies.
###
### @file   fruitsalad_env_setup.rb
### @brief  Environment setup script.
###
### @version \$Id: fruitsalad_env_setup.rb 653 2015-01-05 16:43:04Z emmas $
###
### @warning
###    This software is specifically written for Cirrus Logic devices.
###    It may not be used with other devices.
###

###############################################################################

#
# OS detection and cross-platform magic.
#
if "mingw32" == Gem::Platform.local.os
    # The name of the environmemnt variable that controls where the OS searches
    # for shared libraries.
    Lib = "PATH"
    # The name of the environment variable that controls where the OS searches
    # for executable files.
    Bin = "PATH"
else
    # The name of the environmemnt variable that controls where the OS searches
    # for shared libraries.
    Lib = "LD_LIBRARY_PATH"
    # The name of the environment variable that controls where the OS searches
    # for executable files.
    Bin = "PATH"
end

# setup the home location for FruitSalad if it has not already been set
# Should be set to the directory location of this file.
# N.B. This will not work for the OCRA installer as it copies this file to a new location
# resulting in the executing location becoming %APPDATA%/Local/Temp/ocr<uid>.tmp/src
if ENV['FRUITSALAD_HOME'].nil?
    ENV['FRUITSALAD_HOME'] = File.expand_path( File.dirname(__FILE__) + '/..' )
    puts "Defining FRUITSALAD_HOME as '#{ENV['FRUITSALAD_HOME']}'"
else
    # in case this has been set as a windows path, convert \'s to /.
    if 'mingw32' == Gem::Platform.local.os
        ENV['FRUITSALAD_HOME'] = ENV['FRUITSALAD_HOME'].gsub(/\\/, '/')
    end
    puts "Using user-defined FRUITSALAD_HOME as '#{ENV["FRUITSALAD_HOME"]}'"
end

# The full path to the location of the vendor directory included with
# FruitSalad
VendorLibDirname = File.join( ENV['FRUITSALAD_HOME'], 'lib' )
# The full path to the location of the executable binaries directory included with
# FruitSalad.
BinDirname = File.join( ENV['FRUITSALAD_HOME'], 'bin' )
# The full path to the location of the FruitSalad directory
SrcDirname = ENV['FRUITSALAD_HOME']

# Append FruitSalad core locations to the environment path
$: << SrcDirname
$: << File.join( SrcDirname, 'src' )

if nil == ENV[Lib]
    ENV[Lib] = VendorLibDirname
else
    ENV[Lib] = ENV[Lib] + File::PATH_SEPARATOR + VendorLibDirname
end

if nil == ENV[Bin]
    ENV[Bin] = BinDirname
else
    ENV[Bin] = ENV[Bin] + File::PATH_SEPARATOR + BinDirname
end
################################### END OF FILE ###########################