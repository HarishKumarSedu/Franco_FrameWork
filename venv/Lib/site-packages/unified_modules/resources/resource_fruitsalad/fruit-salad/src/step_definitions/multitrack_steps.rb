################################################################################
##
## Copyright (c) 2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
##
## This software as well as any related documentation is furnished under
## license and may only be used or copied in accordance with the terms of the
## license. The information in this file is furnished for informational use
## only, is subject to change without notice, and should not be construed as
## a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
## (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
## that may appear in this document or any software that may be provided in
## association with this document.
##
## Except as permitted by such license, no part of this document may be
## reproduced, stored in a retrieval system, or transmitted in any form or by
## any means without the express written consent of Cirrus Logic International
## (UK) Ltd or affiliated companies.
##
### @file multitrack_steps.rb
### @brief cucumber steps definition for multitrack based playback.
###
### @version \$Id: multitrack_steps.rb 798 2015-01-29 14:21:19Z emmas $
###
### @warning
###   This software is specifically written for Cirrus Logic devices.
###   It may not be used with other devices.
###
#################################################################################

###############################################################################
#
# @!method When_I_play_tracks
#
# Multi-track playback, with several mono WAV files being played on different
# channels. If a track should be mirrored across multiple channels each channel
# should have a separate entry.
#
#       Usage:
#       When I play tracks:
#               | track file | channel name |
#               | <track>    | <channel>    |
#               ...
#
# @example | foo.wav | top left |
#
# @param table The table of file, channel entries. The filename column must have
#              a heading with the word file in it, and the channel column must
#              have a heading with the word channel in it.
#
###############################################################################
When( /^I play tracks:$/ ) do |table|
    track_list = []
    table.map_headers!(
                        /file/i => :file,
                        /channel/i => :channel
                      )
    table.hashes().each do |row|
        pair = [ row[:file], row[:channel] ]
        track_list << pair
    end

    FruitSalad::get_device.multitrack_playback( track_list )
end

###############################################################################
#
# @!method Given_background_noise_measures
#
# Set the simulated background noise to some volume level, expressed as dB full
# scale. 0dBFS represents maximum volume, above this the noise will clip.
#
#       Usage:
#       Given background noise measures <amplitude> dB FS
#
# @example Given background noise measures -20 dB FS
# @example Given background noise measures 0 dB FS
#
# @param amplitude The amplitude of the noise signal
#
###############################################################################
Given( /background noise measures (#{Number}) ?dB ?FS/ ) do |amplitude|
    FruitSalad::get_device.simulated_noise_model.noise_db = amplitude
end

##################################### END OF FILE #############################