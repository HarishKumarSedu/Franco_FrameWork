################################################################################
##
## Copyright (c) 2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
##
## This software as well as any related documentation is furnished under 
## license and may only be used or copied in accordance with the terms of the 
## license. The information in this file is furnished for informational use 
## only, is subject to change without notice, and should not be construed as 
## a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
## (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
## that may appear in this document or any software that may be provided in
## association with this document. 
##
## Except as permitted by such license, no part of this document may be 
## reproduced, stored in a retrieval system, or transmitted in any form or by 
## any means without the express written consent of Cirrus Logic International
## (UK) Ltd or affiliated companies.  
##
### @file multitrack_playback.feature
### @brief Feature file for functionality relating to multitrack SoundClear Control testing.
###
### @version \$Id: multitrack_playback.feature 983 2015-04-01 09:33:27Z emmas $
###
### @warning
###   This software is specifically written for Cirrus Logic devices.
###   It may not be used with other devices.
###
#################################################################################

###############################################################################
#
# Acceptance tests for functionality relating to multichannel playback for WISCE
# target and for testing multichannel triggering for the SoundClear Control firmware.
#
###############################################################################
@wisce
@bluebox
Feature: Multichannel Soundclear Control triggering.

    ###########################################################################
    #
    # Record the output for all tests in this file.
    #
    ###########################################################################
    Background:
        Given I am recording the output

    ###########################################################################
    #
    # Simple playback test using our pa_multitrack utility to play the same file
    # on four channels.
    #
    ###########################################################################
    Scenario: We can perform 4-channel playback using the TS2000 bluebox
        Given usecase "psia1_to_out1L"
        When I play tracks:
            | file name | channel |
            | resources/test_mono.wav | 1 |
            | resources/test_mono.wav | 2 |
            | resources/test_mono.wav | 3 |
            | resources/test_mono.wav | 4 |
        Then the output was not silence
        And the output has frequency spectrum with peak at 1000 Hz, error 0.5 Hz

    ###########################################################################
    #
    # Simple playback test with one track mixed with background noise.
    #
    ###########################################################################
    Scenario: We can add background noise to 2-channel WAV file
        Given background noise measures -20dB FS
        When I play the audio file "resources/test.wav"
        Then the output was not silence

    ###########################################################################
    #
    # Mix noise with a silent track. If the noise isn't audible the playback will
    # be silent and we'll know there's something wrong.
    #
    ###########################################################################
    Scenario: We can add background noise to silence to get non-silent playback
        Given background noise measures 0dB FS
        When I play the audio file "resources/silence.wav"
        Then the output was not silence

    ###########################################################################
    #
    # Simple playback test with 4-track audio mixed with background noise.
    #
    ###########################################################################
    Scenario: We can add background noise to 4-channel playback
        Given usecase "psia1_to_out1L"
        Given background noise measures -20dB FS
        When I play tracks:
            | file name | channel |
            | resources/test_mono.wav | 1 |
            | resources/test_mono.wav | 2 |
            | resources/test_mono.wav | 3 |
            | resources/test_mono.wav | 4 |
        Then the output was not silence 

################################ END OF FILE ##################################
