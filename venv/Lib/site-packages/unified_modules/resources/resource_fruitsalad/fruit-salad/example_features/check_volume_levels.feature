###############################################################################
###
### Copyright (c) 2015 Cirrus Logic International (UK) Ltd. All rights reserved.
###
### This software as well as any related documentation is furnished under
### license and may only be used or copied in accordance with the terms of the
### license. The information in this file is furnished for informational use
### only, is subject to change without notice, and should not be construed as
### a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
### (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
### that may appear in this document or any software that may be provided in
### association with this document.
###
### Except as permitted by such license, no part of this document may be
### reproduced, stored in a retrieval system, or transmitted in any form or by
### any means without the express written consent of Cirrus Logic International
### (UK) Ltd or affiliated companies.
###
### @file check_volume_levels.feature
### @brief Hardware test to check volume levels are good for firmware tests to pass
### such that signal with high amplitude should not get saturated and signal with
### low amplitude should not get attenuated.
###
### @warning
###    This software is specifically written for Cirrus Logic devices.
###    It may not be used with other devices.
###
###############################################################################
#
# Hardware test to check volume levels are good for firmware tests to pass such
# that signal with high amplitude should not get saturated and signal with low
# amplitude should not get attenuated.
#
# @note : If this test fails then we have to tune volume levels such that this
#  test case should pass.
#
###############################################################################
@hw_setup_tests
Feature: Volume setting
    We should be able to test that the signal is not saturated, attenuated at
    both high and low amplitudes.

    ###########################################################################
    #
    # Capture the output for analysis in all of these tests.
    #
    ###########################################################################
    Background:
        Given I am recording the output

    ###########################################################################
    #
    # We should be able to set volume for signal with high amplitudes so that
    # signal should not get saturated.
    #
    ###########################################################################
    Scenario: Separate channel playback of 1000 and 2000 Hz sinewaves with high
              amplitudes
        When I play for 5 seconds the sinewaves of given amplitudes:
            | frequency | channel | amplitude |
            | 1000 Hz   | 0       | 0.9       |
            | 2000 Hz   | 1       | 0.9       |
        Then the output contains tones with error 5 Hz:
            | frequency |
            | 1000 Hz   |
            | 2 kHz     |
        And the output does not contain tones in bands:
            | low | high |
            | 0   | 995  |
            | 1005 | 1995 |
            | 2005 | 4000 |
        And the output is not saturated for frequency:
            | frequency |
            | 1000 Hz   |
            | 2 kHz     |

    ###########################################################################
    #
    # We should be able to set volume for signal with low amplitudes so that
    # signal should not get attenuated and peak tone should be detected.
    #
    ###########################################################################
    Scenario: Separate channel playback of 1000 and 2000 Hz sinewaves with low
              amplitudes
        When I play for 5 seconds the sinewaves of given amplitudes:
            | frequency | channel | amplitude |
            | 1000 Hz   | 0       | 0.1       |
            | 2000 Hz   | 1       | 0.1       |
        Then the output contains tones with error 5 Hz:
            | frequency |
            | 1000 Hz   |
            | 2 kHz     |
        And the output does not contain tones in bands:
            | low | high |
            | 0   | 995  |
            | 1005 | 1995 |
            | 2005 | 4000 |

#################################### END OF FILE ##############################
