################################################################################
###
### Copyright (c) 2015 Cirrus Logic plc.  All rights reserved.
###
### This software as well as any related documentation is furnished under
### license and may only be used or copied in accordance with the terms of the
### license. The information in this file is furnished for informational use
### only, is subject to change without notice, and should not be construed as
### a commitment by Cirrus Logic plc. Cirrus Logic plc
### assumes no responsibility or liability for any errors or inaccuracies that
### may appear in this document or any software that may be provided in
### association with this document.
###
### Except as permitted by such license, no part of this document may be
### reproduced, stored in a retrieval system, or transmitted in any form or by
### any means without the express written consent of Cirrus Logic plc.
###
### @file ASIO_Example_Test.feature
### @brief An example test specifying a set of usecase scripts as a step.
###
### Warning
###   This software is specifically written for Cirrus devices. It may not be
###   used with other devices.
###
################################################################################
## Engineer: Ben Cunningham (Intern)
## Lochnagar II test feature
## Goal: To play , record and evaluate wav files to verify the operation of
##       channels on LN2
## Note: Will check ONE path (DAC 14 to ADC 14), for example purposes
################################################################################
Feature: ASIO_Example_Test
    ############################################################################
    #
    # Connect to the Lochnagar 2.0 board and device.
    #
    ############################################################################
    Background:
        Given I am connected to a device

    ############################################################################
    #
    # Verification of Lochnagar 2.0 audio path steps
    #
    # N.B. Ch14    -    DAC Ch6 to ADC Ch6 - Connect stereo jack-jack cable from
    #                   "PORT3 IN" to "PORT3 OUT"
    #
    ############################################################################
    Scenario: A sine tone can be played through the Lochnagar 2.0 sound-card and
              recorded via loop-back.
        Given I load use case "lochnagar2_setup"
        When I operate channels:
            | Operation | Channel | File                            |
            | Output    | 14      | resources/Aud_1kHz_1s_-3dB.wav  |
            | Record    | 14      | Recordings/input14.wav          |
        Then the following channels are not silent:
            | 14 |
        And the following files are similar
            | file1                  |   file2                        | max_dB_Variance |
            | Recordings/input14.wav | resources/Aud_1kHz_1s_-3dB.wav | 2.4 |
        And the channel 14 contains tones with error 5 Hz:
            | frequency |
            | 1000 Hz   |
        And the channel 14 does not contain tones in bands with threshold -20 dB:
            | low   | high  |
            | 0     | 995   |
            | 1005  | 20000 |

#################################### END OF FILE ###############################