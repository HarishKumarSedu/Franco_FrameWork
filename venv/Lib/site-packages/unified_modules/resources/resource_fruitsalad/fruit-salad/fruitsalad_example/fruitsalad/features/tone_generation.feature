################################################################################
###
### Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
###
### This software as well as any related documentation is furnished under 
### license and may only be used or copied in accordance with the terms of the 
### license. The information in this file is furnished for informational use 
### only, is subject to change without notice, and should not be construed as 
### a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
### (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
### that may appear in this document or any software that may be provided in
### association with this document. 
###
### Except as permitted by such license, no part of this document may be 
### reproduced, stored in a retrieval system, or transmitted in any form or by 
### any means without the express written consent of Cirrus Logic International
### (UK) Ltd or affiliated companies. 
###
### @file tone_generation.feature
### @brief basic smoke-test for tone generation, playback and analysis.
###
### @version \$Id: tone_generation.feature 974 2015-03-26 15:28:33Z aangus $
###
### @warning
###    This software is specifically written for Cirrus Logic devices.
###    It may not be used with other devices.
###
###############################################################################
#
# Generate a .wav file containing a sine wave of a specified frequency. Playback
# the .wav file using loop-back. Perform frequency analysis of the captured
# recording and determine what frequency the maxima lies at.
#
#################################################################################

Feature: ToneGeneration
    We should be able to play back an arbitrary frequency and expect it to play
    without distortion.

    ###########################################################################
    #
    # Background
    #
    # Describes the assumptions and context shared by all scenarios within this
    # feature file.
    #
    ###########################################################################
    Background:
        Given I am connected to a device

    ###########################################################################
    #
    # Play a 1kHz sine wave and verify that there was output.
    #
    ###########################################################################

    Scenario: Generate and play a 1 kHz sine tone, then confirm that there was sound.
        Given I am recording the output
        When I play a 1 kHz sine wave for 5 seconds
        Then the output was not silence

    ###########################################################################
    #
    # Play a 440 Hz sine wave and verify it was approximately 440 Hz.
    #
    ###########################################################################

    Scenario: Generate and play a 440 Hz sine tone, then confirm its pitch with frequency analysis.

        Given I am recording the output
        When I play a 440 Hz sine wave for 5 seconds
        Then the output has frequency spectrum with peak at 440 Hz, error 0.5 Hz

    ###########################################################################
    #
    # Play 1 second of MLS white noise and verify the signal generator worked.
    #
    ###########################################################################
    Scenario: Playing MLS White Noise should work.

        Given I am recording the output
        When I play 1 second of white noise
        Then the output was not silence

    ###########################################################################
    #
    # Use the error margin for frequency analysis from the configuration property
    # Analyzer_FrequencyTolerance
    #
    ###########################################################################
    Scenario: Default frequency error when checking sine wave.
        Given I am recording the output
        When I play a 1 kHz sine wave for 1 second
        Then the output has peak at 1 kHz

############################## END OF FILE ####################################
