# @title Android and Linux Remote Testing
<!--============================================================================
==
== Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
==
== This software as well as any related documentation is furnished under 
== license and may only be used or copied in accordance with the terms of the 
== license. The information in this file is furnished for informational use 
== only, is subject to change without notice, and should not be construed as 
== a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
== (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
== that may appear in this document or any software that may be provided in
== association with this document. 
==
== Except as permitted by such license, no part of this document may be 
== reproduced, stored in a retrieval system, or transmitted in any form or by 
== any means without the express written consent of Cirrus Logic International
== (UK) Ltd or affiliated companies. 
==
== @file    LinuxRemote.md
== @brief   Markdown documentation file (parsed with yard) for Android and Linux remote testing.
==
== @version \$Id: LinuxRemote.md 1055 2015-05-22 09:21:57Z aangus $
==
== @warning
==   This software is specifically written for Cirrus Logic devices.
==   It may not be used with other devices.
==
=============================================================================-->

Android and Linux Remote Testing
================================

Introduction
------------

The remote target is designed to execute tests on machines running \*nix type
operating systems (Linux, Android, etc.) without having to install FruitSalad
on the device under test. To accomplish this goal ssh is employed to execute
test scenarios on the remote device.

Remote test execution is especially useful when testing targets such as the
Raspberry Pi or Android devices, as any audio analysis or other computationally
intensive tasks will be executed on the controlling machine rather than the
test target.

Configuring the target machine
------------------------------

The test target will have to be configured to accept SSH connections.
Furthermore FruitSalad uses tinyalsa to playback/record audio and to verify
mixer settings so you should make sure that it is present on the target system
(Android devices will have tinyalsa by default).

Configuring FruitSalad for remote testing
-----------------------------------------

In order to successfully execute tests on a remote target you will need to
configure FruitSalad as follows:

1. Supply the location of use cases (`UsecasePath`) specific to the device you
   want to test.
2. It is strongly advisable to use saladmix to set up routes on the test target,
   as the default method - setting up routes using a shell script - may take a
   very long time. To indicate that you want to use saladmix you simply need to
   provide a `SaladMix\_Location`.
3. It may also prove useful to provide the IP address of the device under test
   and login credentials for it (login+password or login+private key), to avoid 
   having to supply these every time you run tests.

In practice your configuration should resemble the examples provided below.

Example configuration for Arndale tests:

    # Tells FruitSalad to search for use cases under the default Arndale usecase
    # directory.
    UsecasePath: "targets/arndale_android_usecases"

    # Location of a saladmix binary.
    SaladMix_Location: "bin/arm-linux-androideabi-saladmix"
    # Upload saladmix to Arndale.
    SaladMix_Upload: true

    # Sets the private key to be used for authentication to <private_key> (note:
    # <private_key> must be a path pointing to an OpenSSH private key)
    Remote_KeyFile: "<private_key>"

    # As /tmp/ is not writeable on Android we need to manually specify an
    # appropriate alternative.
    Remote_TempDir: "/data/tmp/fruitsalad/"

Example configuration for Raspberry Pi tests:

    # Tells FruitSalad to search for use cases under the default PI usecase
    # directory.
    UsecasePath: "targets/pi_usecases"
    # Setting up the use playback from line out and record from mic in as
    # default.
    DefaultUsecases: ["Playback_to_Line_Out", "Record_from_Mic_In"]

    # Use saladmix
    SaladMix_Location: "saladmix"

    # Use <pi_user> and <pi_password> as credentials when connecting to a PI
    # with the ip address <pi_ip_address> (should be an ipv4 address)
    Remote_Address: "<pi_ip_address>"
    Remote_User: "<pi_user>"
    Remote_Password: "<pi_password>"

Running tests
-------------

Executing tests on a remote target is simple; just run:

    ruby fruitsalad.rb remote -f <feature_file> -c <your_config> [-a <remote_user>@<target_ip_address>]

where `<feature_file>` is a valid FruitSalad `*.feature` file, `<your_config>`
is a FruitSalad configuration (described in the previous section),
`<target_ip_address>` is the IP address of the device under test and
`<remote_user>` is the user name you want to use when establishing the SSH
connection. You do not need to specify `<target_ip_address>` and
`<remote_user>` if you have provided them in your configuration file.

**Note**:
the `-c` parameter should immediately preceed the `-a` parameter.
