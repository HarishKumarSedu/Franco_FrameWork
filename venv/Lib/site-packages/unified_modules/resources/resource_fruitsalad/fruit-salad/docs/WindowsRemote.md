# @title Windows Remote Target Setup
<!--============================================================================
==
== Copyright (c) 2014-2015 Cirrus Logic International (UK) Ltd.  All rights reserved.
==
== This software as well as any related documentation is furnished under 
== license and may only be used or copied in accordance with the terms of the 
== license. The information in this file is furnished for informational use 
== only, is subject to change without notice, and should not be construed as 
== a commitment by Cirrus Logic International (UK) Ltd.  Cirrus Logic International
== (UK) Ltd assumes no responsibility or liability for any errors or inaccuracies
== that may appear in this document or any software that may be provided in
== association with this document. 
==
== Except as permitted by such license, no part of this document may be 
== reproduced, stored in a retrieval system, or transmitted in any form or by 
== any means without the express written consent of Cirrus Logic International
== (UK) Ltd or affiliated companies. 
==
== @file    WindowsRemote.md
== @brief   Markdown documentation file (parsed with yard) for windows remote setup.
==
== @version \$Id: WindowsRemote.md 750 2015-01-21 17:41:10Z shackman $
==
== @warning
==   This software is specifically written for Cirrus Logic devices.
==   It may not be used with other devices.
==
=============================================================================-->

Windows&reg; Remote Target Setup
================================

Introduction
------------

The Windows remote target allows test scripts and analysis to be run from a host
machine where the target has limited compute resources or lacks a Ruby installation.

This target relies on using OpenSSH to establish a remote interface between the host and target, 
which must first be installed on the target. This will establish an openssh server that will allow Fruit Salad 
to make connections with the target. This should restart automatically with the target machine.

Fruit Salad will deploy any files it needs to the target once a remote connection has been established.

    *** IN DEVELOPMENT ***
    This feature is still in development and is not complete.
    Currently only supports playback and record operations.

Deploying OpenSSH
------------

This only needs to be done once for a target machine and will add and start the OpenSSHd service allowing remote connections.

* Extract the zip archive `.\tools\openssh_installer.zip` on the target machine.
* From the extracted directory run `openssh_installer.bat` (this will also start the OpenSSH service).
* Within the installer directory a `fruitsalad_id` keyfile will be created. Copy this file to the host running Fruit Salad.

Configuring Fruit Salad
------------

With an OpenSSH service running on the target machine, Fruit Salad can now issue remote commands. To
provide connection details create a new YAML config file with the following details set:

    # username to use during connections
    Remote_User: "<USERNAME>"
    # Address of the target
    Remote_Address: "<ADDRESS>"
    # Keyfile (including path) to use during authentication (e.g. fruitsalad_id)
    Remote_KeyFile: "<PATH_TO_KEYFILE>"

Features can then be run on the remote target by issuing the following command:

    ruby fruitsalad.rb windows_remote -c <path_to_config> -f <path_to_feature>
  
    *** IN DEVELOPMENT ***
    N.B. This feature currently outputs a lot of debugging information to the console.

Troubleshooting
------------

* If connections are being refused, check that the OpenSSHd service is running (Task Manager -> Services).
* If OpenSSH has been reinstalled on the target machine, ensure that `.ssh\known_hosts directory` has been cleaned/removed
   from the machine running FruitSalad (default location is `%HOMEDRIVE%%HOMEPATH%\.ssh\known_hosts`).