"""
API For the Audiohub's fpga. Controls memory space through the 32bit map starting at 0x83c00000
author: Evan Canter <evan.canter@cirus.com>
"""
from cl_test_station.components.component.component import Component


class Ah3Fpga(Component):

    def enable_spmi(self):
        """
        Takes the SPMI core out of reset, enables HI-Z mode, Routes SPMI IRQ line to PDM2_DATA, and unmasks dev_int_3

        :return: None
        """
        # Put SPMI core in reset, disable Peripheral and Manager
        self.block_apis.FAKE_CS.spmi_control.value = 0x10
        # Enable SPMI core
        self.block_apis.FAKE_CS.spmi_control.value = 0x03
        # Enable HI-Z mode
        self.block_apis.FAKE_CS.global_hi_z.value = 0
        # Mux pdm2_data to SPMI IRQ line
        self.block_apis.FAKE_CS.pdm_controls[2]['data']['sel'].value = 0x70
        # Unmask interrupts --> DEV_INT3_SEL = 0x2
        with self.WriteFieldsOptimizer():
            self.block_apis.FAKE_CS.interrupt_selects[0].value = 0x0
            self.block_apis.FAKE_CS.interrupt_selects[1].value = 0x0
            self.block_apis.FAKE_CS.interrupt_selects[2].value = 0x0
            self.block_apis.FAKE_CS.interrupt_selects[3].value = 0x2
