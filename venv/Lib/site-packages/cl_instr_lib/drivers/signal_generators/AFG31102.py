from cl_instr_lib.base_classes.tek_afg.afg_30k_base import Afg30kBase, ProgrammingBounds

# TODO: finish testing all AFG3k methods to ensure they work on this instrument.
class AFG31102(Afg30kBase):
    """Driver class for Tektronix AFG311102 Dual Output function generator"""

    def __init__(self, visa_resource_name=None, logger=None, **kwargs):
        chan_pgm_bounds = ProgrammingBounds(
            # TODO: Change freq_min to be a dictionary is 30k and 3k base class.
            load_z_min=1.0, load_z_max=10000.0,
            ampl_pp_hiz_min=2e-3, ampl_pp_hiz_max=20,
            phase_min=-180, phase_max=180,
            offset_hiz_max=10, offset_hiz_min=-10,
            voltage_window_hiz_min=-10, voltage_window_hiz_max=10,
            freq_min=1e-3, freq_max={
                'SINE': 100e6, 'SQUARE': 80e6, 'PULSE': 80e6, 'RAMP': 1.5e6, 'ARB': 50e6, 'OTHER': 1e6
            },
            freq_sine_burst_min=1e-6, freq_sine_burst_max=50e6,
            freq_arb_burst_min=1e-3, freq_arb_burst_max=25e6,
            ramp_symmetry_min=0.0, ramp_symmetry_max=100.0,
            edge_min=4e-9,
            duty_min=0.1, duty_max=99.999,  # TODO: Duty min corect?
            noise_percent_max=50,
            am_depth_percent_max=120,
            fm_deviation_max=50e6,
            pm_deviation_max=180.0,
            mod_freq_internal_min=1e-3, mod_freq_internal_max=1e6,
            fsk_keyrate_min=1e-3, fsk_keyrate_max=1e6,
            hop_freq_hz_max=100e6,  # TODO: Couldn't find this in datasheet. Number from AFG3102C module.
            burst_ncycles_min=1, burst_ncycles_max=1_000_000,
            burst_tdelay_sec_max=85.0
        )

        # Setup the simulation code inherited from Instrument.
        super().__init__(visa_resource_name, chan_pgm_bounds, logger,
                         model_re='^AFG31102$',
                         sim_idn='TEKTRONIX,AFG31102,C013116,SCPI:99.0 FV:1.5.2',
                         sim_opt='"AFG3BW100"',
                         **kwargs)


if __name__ == '__main__':
    afg31102 = AFG31102('USB0::0x0699::0x035A::C013116')  # Replace visa_resource_name with None for simulated hardware.
    afg31102.debug_options(log_scpi=True, unused_args_handling='LOG_UNUSED', inst_error_handling='LOG_ALWAYS')
