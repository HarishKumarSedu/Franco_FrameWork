"""
Enumerations for Sqa firmware interaction. Based on information from this page: https://docs.cirrus.com/x/A_PHCQ
Author: Evan Canter <evan.canter@cirrus.com>
"""
from enum import Enum


class SqaOperations(Enum):
    I2C_READ = 0
    I2C_WRITE = 1
    I2C_POLL = 2
    TOGGLE_TIMING_CHECK = 3
    I2C_RANDOM_WRITE = 4
    INSERT_PACKET_DELAY = 5
    START_TIMER = 6
    READ_TIMER = 7
    SET_OUTPUT = 8
    CLEAR_OUTPUT = 9
    WAIT_IF_INPUT_IS_SET = 10
    WAIT_IF_INPUT_IS_CLEAR = 11
    SET_I2C_SPEED_AND_TICK = 12
    SET_PWM_OUTPUT = 13
    CLEAR_PWM_OUTPUT = 14
    DISABLE_PWM = 15
    WRITE_FIELD = 16
    SKIP_NAK = 17
    READ_NAK = 18
    SELECT_PORT_MODE = 19


class SqaOperationModes(Enum):
     NOT_STD = 0
     STD_8_BITS = 1
     STD_16_BITS = 2
     STD_32_BITS = 3


class I2cModes(Enum):
     MODE_00 = 0
     MODE_01 = 1
     MODE_10 = 2
     MODE_11 = 3

     @property
     def addressable(self):
         return {
             self.MODE_00: True,
             self.MODE_01: False,
             self.MODE_10: False,
             self.MODE_11: True
         }[self]

     @property
     def header_addr_size(self):
        return {
            self.MODE_00: 4,
            self.MODE_01: 0,
            self.MODE_10: 0,
            self.MODE_11: 4
        }[self]

     @property
     def reg_size(self):
         return {
             self.MODE_00: 2,
             self.MODE_01: 0,
             self.MODE_10: 0,
             self.MODE_11: 4
         }[self]


class SqaDutPortModes(Enum):
     I2C_MODE = 0
     I3C_DEFAULT_MODE = 1
     I3C_MODE = 2


class SqaErrorCodes(Enum):
    NO_ERROR = 0
    CRUS_API_ERROR = 1
    NACK_TIMEOUT = 2
    SQA_HDR_ERROR = 11
    RX_BUFF_OVERFLOW = 21
    BUSY_DURING_TICK = 22
    TX_BUFF_EMPTY = 23
    TX_BUFF_OVERFLOW = 24
    POLL_TIMEOUT = 25
    ERROR_TICK_MISSED = 26
    APPLICATION_ERROR = 33
    TICK_RANGE_ERROR = 34
    SPEED_RANGE_ERROR = 35
    UNKNOWN_ERROR = -1

    @property
    def description(self):
        return {
            self.NO_ERROR: '',
            self.CRUS_API_ERROR: "",
            self.NACK_TIMEOUT: "10 consecutive NAK received for the same I2C operation",
            self.SQA_HDR_ERROR: "Malformed SQA packet header",
            self.RX_BUFF_OVERFLOW: "Response buffer exceeded rx_buffer_start + rx_buffer_size",
            self.BUSY_DURING_TICK: "Interrupt is missed because the processor is busy with other activities",
            self.TX_BUFF_EMPTY: "Stimulus buffer is empty (tx_buffer_size == 0)",
            self.TX_BUFF_OVERFLOW: "Size of the last stimulus packet (header + payload) exceeds tx_buffer_start + tx_buffer_size",
            self.POLL_TIMEOUT: "Timeout occurred prior to reading back expected value while polling",
            self.ERROR_TICK_MISSED: "Not ready with transaction at tick time",
            self.APPLICATION_ERROR: "Unknown error within STM32 application layer",
            self.TICK_RANGE_ERROR: "tick_period is set to less than 100us or greater than 5000us",
            self.SPEED_RANGE_ERROR: "i2c speed is not set to one of: 100, 250, 400, 500, 666, 750, 1000kHz",
            self.UNKNOWN_ERROR: "Unknown error code. Firmware might not be flashed."
        }[self]


class SqaPortModes(Enum):
    I2C = 0
    I3C_DM = 1
    I3C = 2
